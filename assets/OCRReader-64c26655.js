import{j as t}from"./index-aa9db19d.js";import{r as g}from"./vendor-react-725446ef.js";import{T as E}from"./vendor-scan-056f3be7.js";const U=({onScanComplete:I})=>{const[x,b]=g.useState(null),[m,d]=g.useState(!1),[v,j]=g.useState(0),[C,o]=g.useState(""),R=g.useRef(null),N=s=>{if(s.target.files&&s.target.files[0]){const a=s.target.files[0];b(URL.createObjectURL(a)),S(a)}},S=async s=>{d(!0),j(0),o("Initializing OCR engine...");try{o("Optimizing image...");const a=await y(s),p=await E.recognize(a,"eng",{logger:n=>{n.status==="recognizing text"?(j(Math.round(n.progress*100)),o(`Scanning: ${Math.round(n.progress*100)}%`)):o(n.status)}}),r=O(p.data.text);if(!r)throw new Error("No text found. Try a clearer image.");I(r),d(!1),o("Complete!")}catch(a){console.error("OCR Error:",a),o(a.message||"Error scanning image."),d(!1)}},y=s=>new Promise((a,p)=>{const r=new Image;r.onload=()=>{const n=document.createElement("canvas"),u=n.getContext("2d"),h=1500;let i=r.width,l=r.height;i>h&&(l=l*h/i,i=h),n.width=i,n.height=l,u.drawImage(r,0,0,i,l);const w=u.getImageData(0,0,i,l),c=w.data;for(let e=0;e<c.length;e+=4){const f=.21*c[e]+.72*c[e+1]+.07*c[e+2]<140?0:255;c[e]=f,c[e+1]=f,c[e+2]=f}u.putImageData(w,0,0),n.toBlob(e=>{a(e)},"image/jpeg",.95)},r.onerror=p,r.src=URL.createObjectURL(s)}),O=s=>s.replace(/\n\s*\n/g,", ").replace(/\n/g," ").replace(/[|]/g,"l").trim();return t.jsxs("div",{className:"ocr-reader",children:[t.jsx("input",{type:"file",accept:"image/*",ref:R,onChange:N,style:{display:"none"},capture:"environment"}),t.jsxs("button",{className:"btn btn-secondary ocr-btn",onClick:()=>R.current.click(),disabled:m,children:["ðŸ“¸ ",m?"Scanning...":"Scan Label (Beta)"]}),m&&t.jsxs("div",{className:"ocr-progress",children:[t.jsx("div",{className:"progress-bar-bg",children:t.jsx("div",{className:"progress-bar-fill",style:{width:`${v}%`}})}),t.jsx("span",{className:"status-text",children:C})]}),x&&!m&&t.jsxs("div",{className:"img-preview",children:[t.jsx("img",{src:x,alt:"Scanned label"}),t.jsx("button",{className:"clear-img",onClick:()=>b(null),children:"âœ•"})]})]})};export{U as default};
