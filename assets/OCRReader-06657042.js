import{u as _,j as e}from"./index-f253ba61.js";import{r as n}from"./vendor-react-99dc8906.js";import{T as N}from"./vendor-scan-056f3be7.js";const w=({onScanComplete:m})=>{const{t:s}=_(),[i,g]=n.useState(null),[c,o]=n.useState(!1),[x,u]=n.useState(0),[f,a]=n.useState(""),p=n.useRef(null),h=t=>{if(t.target.files&&t.target.files[0]){const r=t.target.files[0];g(URL.createObjectURL(r)),b(r)}},b=async t=>{o(!0),u(0),a(s("ocr.status_init"));try{a(s("ocr.status_optimize"));const r=await preprocessImage(t),R=await N.recognize(r,"eng",{logger:l=>{l.status==="recognizing text"&&(u(Math.round(l.progress*100)),a(s("ocr.status_scanning").replace("{percent}",Math.round(l.progress*100))))}}),d=j(R.data.text);if(!d)throw new Error(s("ocr.error_no_text"));m(d),o(!1),a(s("ocr.status_complete"))}catch(r){console.error("OCR Error:",r),a(r.message||s("ocr.error_generic")),o(!1)}},j=t=>t.replace(/\n\s*\n/g,", ").replace(/\n/g," ").replace(/[|]/g,"l").trim();return e.jsxs("div",{className:"ocr-reader",children:[e.jsx("input",{type:"file",accept:"image/*",ref:p,onChange:h,style:{display:"none"},capture:"environment"}),e.jsxs("button",{className:"btn btn-secondary ocr-btn",onClick:()=>p.current.click(),disabled:c,children:["ðŸ“¸ ",s(c?"ocr.btn_scanning":"ocr.btn_scan")]}),c&&e.jsxs("div",{className:"ocr-progress",children:[e.jsx("div",{className:"progress-bar-bg",children:e.jsx("div",{className:"progress-bar-fill",style:{width:`${x}%`}})}),e.jsx("span",{className:"status-text",children:f})]}),i&&!c&&e.jsxs("div",{className:"img-preview",children:[e.jsx("img",{src:i,alt:"Scanned label"}),e.jsx("button",{className:"clear-img",onClick:()=>g(null),children:"âœ•"})]})]})};export{w as default};
